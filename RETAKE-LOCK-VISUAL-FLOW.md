# Retake Score Entry Lock - Visual Flow Diagram

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  RETAKE SCORE ENTRY PERMISSION FLOW                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

                            START
                              โ
                              โผ
                    โโโโโโโโโโโโโโโโโโโ
                    โ Admin nhแบญp ฤiแปm โ
                    โ TX, ฤK, Final   โ
                    โโโโโโโโโโฌโโโโโโโโโ
                             โ
                             โผ
                    โโโโโโโโโโโโโโโโโโโ
                    โ Lฦฐu ฤiแปm vรo DB โ
                    โ Status = DRAFT  โ
                    โโโโโโโโโโฌโโโโโโโโโ
                             โ
                             โผ
                  โโโโโโโโโโโโโโโโโโโโโโโโ
                  โ  Final Score < 5?    โ
                  โ  (Cแบงn thi lแบกi)       โ
                  โโโโโโโโฌโโโโโโโโโฌโโโโโโโ
                     NO  โ        โ  YES
                         โ        โ
                โโโโโโโโโโผโโโโโ   โ
                โ โ ฤรฃ ฤแบกt   โ   โ
                โ Khรดng cแบงn   โ   โ
                โ thi lแบกi     โ   โ
                โโโโโโโโโโโโโโโ   โ
                                  โผ
                         โโโโโโโโโโโโโโโโโโ
                         โ TBKT < 5?      โ
                         โ (Cแบงn hแปc lแบกi)  โ
                         โโโโโฌโโโโโโโโโฌโโโโ
                         NO  โ        โ  YES
                             โ        โ
                    โโโโโโโโโโผโโโโโ   โโโโโโโโ
                    โ Cแบงn TH I LแบIโ          โ
                    โโโโโโโโโโฌโโโโโ          โ
                             โ               โ
                             โผ               โผ
                    โโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโ
                    โ Grade Status?  โ  โ Cแบงn HแปC LแบI   โ
                    โโโโโฌโโโโโโโโโโโโโ  โโโโโโโโโโฌโโโโโโโโ
                        โ                        โ
         โโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโ        โ
         โ              โ              โ        โ
         โผ              โผ              โผ        โผ
  โโโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  (Same check)
  โ   DRAFT   โ  โ PENDING  โ  โAPPROVED  โ
  โ           โ  โ  REVIEW  โ  โ TX_DK    โ
  โโโโโโโฌโโโโโโ  โโโโโโโฌโโโโโ  โโโโโโฌโโโโโโ
        โ              โ             โ
        โโโโโโโโฌโโโโโโโโ             โ
               โ                     โ
               โผ                     โผ
      โโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโ
      โ ๐ LOCKED      โ    โ โ UNLOCKED    โ
      โ                โ    โ                โ
      โ Hiแปn thแป:      โ    โ Hiแปn thแป:      โ
      โ Warning box    โ    โ Action button  โ
      โ "Chฦฐa duyแปt   โ    โ "Nhแบญp ฤiแปm     โ
      โ  TX/ฤK"        โ    โ  thi lแบกi"      โ
      โโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโ


โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      PERMISSION MATRIX                                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

Grade Status      | isTxDkApproved | Show Warning | Show Button | Can Enter
------------------+----------------+--------------+-------------+----------
DRAFT             |     false      |     โ       |     โ      |    โ
PENDING_REVIEW    |     false      |     โ       |     โ      |    โ
APPROVED_TX_DK    |     true       |     โ       |     โ      |    โ
FINAL_ENTERED     |     true       |     โ       |     โ      |    โ
FINALIZED         |     true       |     โ       |     โ      |    โ
null/undefined    |     false      |     โ       |     โ      |    โ


โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    UI COMPONENT TREE                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

GradeEntryPageComponent
โ
โโ State: gradeStatuses
โ  โโ { studentId: { gradeId, gradeStatus, lockStatus, ... } }
โ
โโ Table โ Row โ Cell "Thi lแบกi/Hแปc lแบกi"
   โ
   โโ <RetakeManagementComponent
      โ  student={...}
      โ  gradeData={...}
      โ  gradeStatus={gradeStatuses[student.id]}  โ PASS gradeStatus
      โ  ...
      />
      โ
      โโ const isTxDkApproved = CHECK gradeStatus
      โ  โโ APPROVED_TX_DK || FINAL_ENTERED || FINALIZED
      โ
      โโ IF needsAction && !isTxDkApproved
      โ  โโ <div>๐ Chฦฐa duyแปt TX/ฤK</div>
      โ
      โโ IF needsAction && isTxDkApproved
         โโ <button>๐ Nhแบญp ฤiแปm thi lแบกi</button>


โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                       BEFORE vs AFTER                                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

BEFORE (Khรดng cรณ lock):
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Grade: DRAFT, Final: 4.5 (< 5)                                           โ
โ                                                                           โ
โ [Cแปt Thi lแบกi/Hแปc lแบกi]                                                   โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโ                                               โ
โ โ ๐ด Cแบงn thi lแบกi        โ                                               โ
โ โ [๐ Nhแบญp ฤiแปm thi lแบกi]โ  โ Button hiแปn thแป NGAY                       โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโ                                               โ
โ                                                                           โ
โ โ๏ธ Vแบฅn ฤแป: Admin cรณ thแป nhแบญp ฤiแปm thi lแบกi KHI TX/ฤK chฦฐa ฤฦฐแปฃc duyแปt!  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

AFTER (Cรณ lock):
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Grade: DRAFT, Final: 4.5 (< 5)                                           โ
โ                                                                           โ
โ [Cแปt Thi lแบกi/Hแปc lแบกi]                                                   โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโ                                               โ
โ โ ๐ด Cแบงn thi lแบกi        โ                                               โ
โ โ โโโโโโโโโโโโโโโโโโโโโ โ                                               โ
โ โ โ๐ Chฦฐa duyแปt TX/ฤKโ โ  โ Warning box thay vรฌ button                 โ
โ โ โโโโโโโโโโโโโโโโโโโโโ โ                                               โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโ                                               โ
โ                                                                           โ
โ โ Admin PHแบขI duyแปt TX/ฤK trฦฐแปc khi nhแบญp ฤiแปm thi lแบกi                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

--- Sau khi Admin duyแปt TX/ฤK ---

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Grade: APPROVED_TX_DK, Final: 4.5 (< 5)                                  โ
โ                                                                           โ
โ [Cแปt Thi lแบกi/Hแปc lแบกi]                                                   โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโ                                               โ
โ โ ๐ด Cแบงn thi lแบกi        โ                                               โ
โ โ โโโโโโโโโโโโโโโโโโโโโ โ                                               โ
โ โ โ๐ Nhแบญp ฤiแปm thi lแบกiโ โ  โ Button GIแป HIแปN THแป                       โ
โ โ โโโโโโโโโโโโโโโโโโโโโ โ                                               โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโ                                               โ
โ                                                                           โ
โ โ Cรณ thแป nhแบญp ฤiแปm thi lแบกi                                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ


โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    CODE EXECUTION FLOW                                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

1. Page Load: GradeEntryPageComponent
   โ
2. Fetch grades + gradeStatuses from backend
   โ
3. Render table with students
   โ
4. For each student row:
   โโ Get gradeStatuses[student.id]
   โ  Example: { gradeId: 123, gradeStatus: 'DRAFT', ... }
   โ
   โโ Pass to RetakeManagementComponent
      โ
5. RetakeManagementComponent receives:
   - gradeStatus = { gradeStatus: 'DRAFT', ... }
   โ
6. Calculate isTxDkApproved:
   const isTxDkApproved = gradeStatus && (
     gradeStatus.gradeStatus === 'APPROVED_TX_DK' ||
     gradeStatus.gradeStatus === 'FINAL_ENTERED' ||
     gradeStatus.gradeStatus === 'FINALIZED'
   );
   // Result: false (DRAFT is not approved)
   โ
7. Render logic:
   if (needsAction && !isTxDkApproved) {
     return <WarningBox>๐ Chฦฐa duyแปt TX/ฤK</WarningBox>
   }
   // Warning box rendered โ
   
   if (needsAction && isTxDkApproved) {
     return <Button>Nhแบญp ฤiแปm thi lแบกi</Button>
   }
   // Button NOT rendered โ


โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     REAL WORLD EXAMPLE                                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

Student: Nguyแปn Vฤn A (ID: 101)
Subject: Toรกn hแปc (ID: 5)

Timeline:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ Day 1 - 10:00 AM: Teacher nhแบญp ฤiแปm
โโ TX: [8, 7, 9] โ Average: 8.0
โโ ฤK: [7, 8] โ Average: 7.5
โโ TBKT = (8.0 ร 20% + 7.5 ร 20%) / 40% = 7.75
โโ Final: 4.5
โโ TBMH = (7.75 ร 40% + 4.5 ร 60%) = 5.8
โโ Status: DRAFT

๐ Bแบฃng ฤiแปm hiแปn thแป:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Student: Nguyแปn Vฤn A              โ
โ TX: 8, 7, 9  ฤK: 7, 8  Final: 4.5 โ
โ                                    โ
โ [Thi lแบกi/Hแปc lแบกi]                 โ
โ ๐ด Cแบงn thi lแบกi                    โ
โ ๐ Chฦฐa duyแปt TX/ฤK               โ  โ LOCKED
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ Day 1 - 2:00 PM: Admin review vร duyแปt
โโ Admin check ฤiแปm TX, ฤK
โโ Nhแบฅn "Duyแปt tแบฅt cแบฃ" hoแบทc "Duyแปt" cho tแปซng sinh viรชn
โโ Status: DRAFT โ APPROVED_TX_DK

๐ Bแบฃng ฤiแปm hiแปn thแป:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Student: Nguyแปn Vฤn A              โ
โ TX: 8, 7, 9  ฤK: 7, 8  Final: 4.5 โ
โ                                    โ
โ [Thi lแบกi/Hแปc lแบกi]                 โ
โ ๐ด Cแบงn thi lแบกi                    โ
โ [๐ Nhแบญp ฤiแปm thi lแบกi]            โ  โ UNLOCKED
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ Day 2 - 9:00 AM: Admin nhแบญp ฤiแปm thi lแบกi
โโ Click "๐ Nhแบญp ฤiแปm thi lแบกi"
โโ Modal mแป โ Nhแบญp Final (retake): 6.5
โโ Save โ Tแบกo GradeRetake record
โโ Calculate new TBMH: (7.75 ร 40% + 6.5 ร 60%) = 7.0 โ PASS โ

๐ Bแบฃng ฤiแปm hiแปn thแป:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Student: Nguyแปn Vฤn A              โ
โ Original Final: 4.5                โ
โ Retake Final: 6.5                  โ
โ New TBMH: 7.0                      โ
โ                                    โ
โ [Thi lแบกi/Hแปc lแบกi]                 โ
โ โ ฤรฃ ฤแบกt (Thi lแบกi)               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ


โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                       EDGE CASES                                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

Edge Case 1: Grade chฦฐa lฦฐu vรo DB
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
gradeStatus = null/undefined
isTxDkApproved = false
โ Show warning box โ

Edge Case 2: Multiple students, mixed statuses
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
Student A: APPROVED_TX_DK โ Show button โ
Student B: DRAFT โ Show warning โ๏ธ
Student C: FINALIZED โ Show button โ
โ Each row independent โ

Edge Case 3: Grade ฤฦฐแปฃc duyแปt nhฦฐng khรดng cแบงn thi lแบกi
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
gradeStatus = 'APPROVED_TX_DK'
Final: 8.5 (>= 5) โ PASS
needsAction = false
โ NO warning, NO button (correct) โ

Edge Case 4: Status transition during session
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
Initial: DRAFT โ Warning box
Admin approves โ APPROVED_TX_DK
โ UI updates via state (no reload needed) โ
โ Warning box โ Button (real-time) โ
